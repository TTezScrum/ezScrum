*** Settings ***
Documentation     CI 測試不穩定,需加入同步機制?
Suite Setup       TaskBoard - Setup
Suite Teardown    TaskBoard - Teardown
Force Tags        TaskBoard
Resource          keywords/common_resource.txt
Resource          keywords/ezScrum_Login.txt
Resource          keywords/Project/ezScrum_Project.txt
Resource          keywords/ProductBacklog/ezScrum_ProductBacklog_Story.txt
Resource          keywords/ProductBacklog/ezScrum_ProductBacklog_Tag.txt
Resource          keywords/SprintPlan/ezScrum_SprintPlan_Sprint.txt
Resource          keywords/SprintBacklog/ezScrum_SprintBacklog_Story.txt
Resource          keywords/SprintBacklog/ezScrum_SprintBacklog_Task.txt
Resource          keywords/SprintBacklog/ezScrum_SprintBacklog_Sprint.txt
Resource          keywords/TaskBoard/ezScrum_TaskBoard.txt
Resource          keywords/TaskBoard/ezScrum_TaskBoard_SetupTeardown.txt
Resource          Global Define.txt
Resource          ServerConfig.txt
Library           BuiltIn
Library           Collections
Library           keywords/lib/Selenium2Improved.py
Resource          keywords/TaskBoard/ezScrum_TaskBoard_AttachFile_SetupTeardown.txt
Library           keywords/lib/DatabaseHandler.py

*** Test Cases ***
Test TaskBoard - Sprint Information
    [Documentation]    驗證TaskBoard頁面，有關於Sprint Information的資料是否正確
    [Tags]    Unstable
    [Setup]    TaskBoard - Sprint Information Setup
    Go To Page    TaskBoard
    # Verify sprint information
    Compare Field Content    //div[@id="TaskBoard_Page"]//input[@name="SprintGoal"]    TaskBoard AT
    Compare Field Content    //div[@id="TaskBoard_Page"]//label[text()="Handler:"]/..//input[@type="text"]    ALL
    Compare Field Content    //div[@id="TaskBoard_Page"]//label[text()="Sprint ID:"]/..//input[@type="text"]    Sprint #${tcStoryID}
    Compare Field Content    //div[@id="TaskBoard_Page"]//input[@name="CurrentStoryPoint"]    2
    Compare Field Content    //div[@id="TaskBoard_Page"]//input[@name="CurrentTaskPoint"]    ${tcTaskEstimate}
    Compare Field Content    //div[@id="TaskBoard_Page"]//input[@name="ReleaseID"]    None
    # Verify taskcard information
    # story information
    ${_TempStoryName}=    Get Text    xpath=//div[@id="${tcStoryID}_new"]//table[@class="StoryCard_Header"]//td[1]/h2[text()="[Story]\ \ #${tcStoryID}"]/../../../../../../../..//td[@class="StroyCard_Description"]
    ${_TempStoryEstimate}=    Get Text    xpath=//div[@id="${tcStoryID}_new"]//table[@class="StoryCard_Header"]//td[1]/h2[text()="[Story]\ \ #${tcStoryID}"]/../../../../../../../..//td[@class="StoryCard_Value"]
    Should Be Equal As Strings    ${_TempStoryName}    ${tcStoryName}
    Should Be Equal    ${_TempStoryEstimate}    ${tcStoryEstimate} Point    # x Point
    # variables
    Verify Story Information With Arguments In TaskBoard    ${tcStoryID}    ${tcStoryName}    ${tcStoryValue}    ${tcStoryEstimate}    ${tcStoryImportance}    ${EMPTY}
    ...    ${tcStoryNotes}    ${tcStoryHowToDemo}
    # task information
    ${_TempTaskName}=    Get Text    xpath=//div[@id="${tcStoryID}_new"]//table[@class="TaskCard_Header"]//td[2]/h2[text()="[Task]\ \ #${tcTaskID}"]/../../../../../../../..//td[@class="TaskCard_Description"]
    ${_TempTaskEstimate}=    Get Text    xpath=//div[@id="${tcStoryID}_new"]//table[@class="TaskCard_Header"]//td[2]/h2[text()="[Task]\ \ #${tcTaskID}"]/../../../../../../../..//td[@class="TaskCard_Value"]
    Should Be Equal As Strings    ${_TempTaskName}    ${tcTaskName}
    Should Be Equal    ${_TempTaskEstimate}    ${tcTaskEstimate} hr    # x hr
    # Variable
    Set Test Variable    ${tcTaskName}    task 1 for test Sprint Information
    Set Test Variable    ${tcTaskEstimate}    3
    Set Test Variable    ${tcTaskNotes}    notes for test Sprint Information
    Verify Task Information With Arguments In TaskBoard    ${tcTaskID}    ${tcTaskName}    ${EMPTY}    ${EMPTY}    ${tcTaskEstimate}    ${tcTaskEstimate}
    ...    ${tcTaskNotes}
    [Teardown]    TaskBoard - Sprint Information Teardown

Test TaskBoard - Task Checked Out
    [Documentation]    驗證TaskBoard頁面，有關於 Task 從 Not Checked Out 拖拉至 Checked Out 後，資料是否正確
    [Tags]    Unstable
    [Setup]    TaskBoard - Task Checked Out Setup
    Comment    Set Selenium Speed    ${SELENIUM_SPEED_SLOW}
    Go To Page    TaskBoard
    Task Checked Out With Arguments    ${tcStoryID}    ${tcTaskID}
    # Verify taskcard information
    ${_TaskHandler}=    Set Variable    admin
    ${_TempTaskDescription}=    Get Text    xpath=//div[@id="${tcStoryID}_assigned"]//table[@class="TaskCard_Header"]//td[2]/h2[text()="[Task]\ \ #${tcTaskID}"]/../../../../../../../..//td[@class="TaskCard_Description"]
    ${_TempTaskEstimate}=    Get Text    xpath=//div[@id="${tcStoryID}_assigned"]//table[@class="TaskCard_Header"]//td[2]/h2[text()="[Task]\ \ #${tcTaskID}"]/../../../../../../../..//td[@class="TaskCard_Value"]
    ${_TempTaskHandler}=    Get Text    xpath=//div[@id="${tcStoryID}_assigned"]//table[@class="TaskCard_Header"]//td[2]/h2[text()="[Task]\ \ #${tcTaskID}"]/../../../../../../../..//span[@class="TaskCard_Handler"]
    Should Be Equal As Strings    ${_TempTaskDescription}    task 1 for test task Checked Out
    Should Be Equal    ${_TempTaskEstimate}    3 hr    # x hr
    Should Be Equal As Strings    ${_TempTaskHandler}    ${_TaskHandler}
    Go To Page    Sprint Backlog
    Xpath Should Match X Times    //td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../../../tr[2]//div[text()="${tcTaskName}"]/../../td[3]/div[text()="${tcTaskName}"]    1
    Xpath Should Match X Times    //td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../../../tr[2]//div[text()="${tcTaskName}"]/../../td[6]/div[text()="${tcTaskEstimate}"]    1
    Xpath Should Match X Times    //td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../../../tr[2]//div[text()="${tcTaskName}"]/../../td[7]/div[text()="${_TaskHandler}"]    1
    Xpath Should Match X Times    //td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../../../tr[2]//div[text()="${tcTaskName}"]/../../td[8]/div[text()="assigned"]    1
    [Teardown]    TaskBoard - Task Checked Out Teardown

Test TaskBoard - Task Done
    [Documentation]    驗證TaskBoard頁面，有關於 Task 從 Checked Out 拖拉至 Done 後，資料是否正確
    [Tags]    Unstable
    [Setup]    TaskBoard - Task Done Setup
    Set Selenium Speed    ${SELENIUM_SPEED_SLOW}
    Go To Page    TaskBoard
    Task Checked Out With Arguments    ${tcStoryID}    ${tcTaskID}
    Task Done With Arguments    ${tcStoryID}    ${tcTaskID}
    # Verify taskcard information
    ${_TaskHandler}=    Set Variable    admin
    ${_TempTaskDescription}=    Get Text    xpath=//div[@id="${tcStoryID}_closed"]//table[@class="TaskCard_Header"]//td[2]/h2[text()="[Task]\ \ #${tcTaskID}"]/../../../../../../../..//td[@class="TaskCard_Description"]
    ${_TempTaskEstimate}=    Get Text    xpath=//div[@id="${tcStoryID}_closed"]//table[@class="TaskCard_Header"]//td[2]/h2[text()="[Task]\ \ #${tcTaskID}"]/../../../../../../../..//td[@class="TaskCard_Value"]
    ${_TempTaskHandler}=    Get Text    xpath=//div[@id="${tcStoryID}_closed"]//table[@class="TaskCard_Header"]//td[2]/h2[text()="[Task]\ \ #${tcTaskID}"]/../../../../../../../..//span[@class="TaskCard_Handler"]
    Should Be Equal As Strings    ${_TempTaskDescription}    ${tcTaskName}
    Should Be Equal    ${_TempTaskEstimate}    0 hr    # x hr
    Should Be Equal As Strings    ${_TempTaskHandler}    ${_TaskHandler}
    Go To Page    Sprint Backlog
    Xpath Should Match X Times    //td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../../../tr[2]//div[text()="${tcTaskName}"]/../../td[3]/div[text()="${tcTaskName}"]    1
    Xpath Should Match X Times    //td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../../../tr[2]//div[text()="${tcTaskName}"]/../../td[6]/div[text()="${tcTaskEstimate}"]    1
    Xpath Should Match X Times    //td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../../../tr[2]//div[text()="${tcTaskName}"]/../../td[7]/div[text()="${_TaskHandler}"]    1
    Xpath Should Match X Times    //td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../../../tr[2]//div[text()="${tcTaskName}"]/../../td[8]/div[text()="closed"]    1
    [Teardown]    TaskBoard - Task Done Teardown

Test TaskBoard - Task ReOpen
    [Documentation]    驗證TaskBoard頁面，有關於 Task 從 Done 拖拉至 Not Checked Out 後，資料是否正確
    [Tags]    Unstable
    [Setup]    TaskBoard - Task ReOpen Setup
    Set Selenium Speed    ${SELENIUM_SPEED_SLOW}
    Go To Page    TaskBoard
    Task Checked Out With Arguments    ${tcStoryID}    ${tcTaskID}
    Task Done With Arguments    ${tcStoryID}    ${tcTaskID}
    Task ReOpen With Arguments    ${tcStoryID}    ${tcTaskID}
    # Verify taskcard information
    ${_TaskHandler}=    Set Variable    admin
    ${_TempTaskDescription}=    Get Text    xpath=//div[@id="${tcStoryID}_assigned"]//table[@class="TaskCard_Header"]//td[2]/h2[text()="[Task]\ \ #${tcTaskID}"]/../../../../../../../..//td[@class="TaskCard_Description"]
    ${_TempTaskEstimate}=    Get Text    xpath=//div[@id="${tcStoryID}_assigned"]//table[@class="TaskCard_Header"]//td[2]/h2[text()="[Task]\ \ #${tcTaskID}"]/../../../../../../../..//td[@class="TaskCard_Value"]
    ${_TempTaskHandler}=    Get Text    xpath=//div[@id="${tcStoryID}_assigned"]//table[@class="TaskCard_Header"]//td[2]/h2[text()="[Task]\ \ #${tcTaskID}"]/../../../../../../../..//span[@class="TaskCard_Handler"]
    Should Be Equal As Strings    ${_TempTaskDescription}    ${tcTaskName}
    Should Be Equal    ${_TempTaskEstimate}    3 hr    # x hr
    Should Be Equal As Strings    ${_TempTaskHandler}    ${_TaskHandler}
    Go To Page    Sprint Backlog
    Xpath Should Match X Times    //td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../../../tr[2]//div[text()="${tcTaskName}"]/../../td[3]/div[text()="${tcTaskName}"]    1
    Xpath Should Match X Times    //td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../../../tr[2]//div[text()="${tcTaskName}"]/../../td[6]/div[text()="${tcTaskEstimate}"]    1
    Xpath Should Match X Times    //td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../../../tr[2]//div[text()="${tcTaskName}"]/../../td[7]/div[text()="${_TaskHandler}"]    1
    Xpath Should Match X Times    //td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../../../tr[2]//div[text()="${tcTaskName}"]/../../td[8]/div[text()="assigned"]    1
    [Teardown]    TaskBoard - Task ReOpen Teardown

Test TaskBoard - Task ReChecked Out
    [Documentation]    驗證TaskBoard頁面，有關於 Task 從 Checked Out \ 拖拉至 Not Checked Out 後，資料是否正確
    [Tags]    Unstable
    [Setup]    TaskBoard - Task ReChecked Out Setup
    Set Selenium Speed    ${SELENIUM_SPEED_SLOW}
    Go To Page    TaskBoard
    Task Checked Out With Arguments    ${tcStoryID}    ${tcTaskID}
    #2017/12/16: We make task card can't move from Checked Out to Not Checked Out when the remains of task card has been changed.
    Comment    Task Done With Arguments    ${tcStoryID}    ${tcTaskID}
    Comment    Task ReOpen With Arguments    ${tcStoryID}    ${tcTaskID}
    Task ReChecked Out With Arguments    ${tcStoryID}    ${tcTaskID}
    # Verify taskcard information
    ${_TaskHandler}=    Set Variable    admin
    ${_TempTaskDescription}=    Get Text    xpath=//div[@id="${tcStoryID}_new"]//table[@class="TaskCard_Header"]//td[2]/h2[text()="[Task]\ \ #${tcTaskID}"]/../../../../../../../..//td[@class="TaskCard_Description"]
    ${_TempTaskEstimate}=    Get Text    xpath=//div[@id="${tcStoryID}_new"]//table[@class="TaskCard_Header"]//td[2]/h2[text()="[Task]\ \ #${tcTaskID}"]/../../../../../../../..//td[@class="TaskCard_Value"]
    Should Be Equal As Strings    ${_TempTaskDescription}    ${tcTaskName}
    Should Be Equal    ${_TempTaskEstimate}    3 hr    # x hr
    Go To Page    Sprint Backlog
    Xpath Should Match X Times    //td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../../../tr[2]//div[text()="${tcTaskName}"]/../../td[3]/div[text()="${tcTaskName}"]    1
    Xpath Should Match X Times    //td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../../../tr[2]//div[text()="${tcTaskName}"]/../../td[6]/div[text()="${tcTaskEstimate}"]    1
    Xpath Should Match X Times    //td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../../../tr[2]//div[text()="${tcTaskName}"]/../../td[7]/div[text()="${_TaskHandler}"]    0
    Xpath Should Match X Times    //td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../../../tr[2]//div[text()="${tcTaskName}"]/../../td[8]/div[text()="new"]    1
    [Teardown]    TaskBoard - Task ReChecked Out Teardown

Test TaskBoard - Story Done
    [Documentation]    驗證TaskBoard頁面，有關於 Story 從 Not Checked Out 拖拉至 Done 後，資料是否正確
    [Tags]    Unstable
    [Setup]    TaskBoard - Story Done Setup
    Set Selenium Speed    ${SELENIUM_SPEED_SLOW}
    Go To Page    TaskBoard
    Task Checked Out With Arguments    ${tcStoryID}    ${tcTaskID}
    Task Done With Arguments    ${tcStoryID}    ${tcTaskID}
    Story Done With Arguments    ${tcStoryID}
    # Verify taskcard information
    ${_TempStoryDescription}=    Get Text    xpath=//div[@id="${tcStoryID}_closed"]//table[@class="StoryCard_Header"]//td[1]/h2[text()="[Story]\ \ #${tcStoryID}"]/../../../../../../../..//td[@class="StroyCard_Description"]
    ${_TempStoryEstimate}=    Get Text    xpath=//div[@id="${tcStoryID}_closed"]//table[@class="StoryCard_Header"]//td[1]/h2[text()="[Story]\ \ #${tcStoryID}"]/../../../../../../../..//td[@class="StoryCard_Value"]
    Should Be Equal As Strings    ${_TempStoryDescription}    ${tcStoryName}
    Should Be Equal    ${_TempStoryEstimate}    ${tcStoryEstimate} Point    # x Point
    Go To Page    Sprint Backlog
    Xpath Should Match X Times    //div[text()="story for taskboard AT"]/../../td[8]/div[text()="closed"]    1
    [Teardown]    TaskBoard - Story Done Teardown

Test TaskBoard - Story ReOpen
    [Documentation]    驗證TaskBoard頁面，有關於 Story 從 Done 拖拉至 Not Checked Out 後，資料是否正確
    [Tags]    Unstable
    [Setup]    TaskBoard - Story ReOpen Setup
    Set Selenium Speed    ${SELENIUM_SPEED_SLOW}
    Go To Page    TaskBoard
    Task Checked Out With Arguments    ${tcStoryID}    ${tcTaskID}
    Task Done With Arguments    ${tcStoryID}    ${tcTaskID}
    Story Done With Arguments    ${tcStoryID}
    Story Reopen With Arguments    ${tcStoryID}
    # Verify taskcard information
    ${_TempStoryDescription}=    Get Text    xpath=//div[@id="${tcStoryID}_new"]//table[@class="StoryCard_Header"]//td[1]/h2[text()="[Story]\ \ #${tcStoryID}"]/../../../../../../../..//td[@class="StroyCard_Description"]
    ${_TempStoryEstimate}=    Get Text    xpath=//div[@id="${tcStoryID}_new"]//table[@class="StoryCard_Header"]//td[1]/h2[text()="[Story]\ \ #${tcStoryID}"]/../../../../../../../..//td[@class="StoryCard_Value"]
    Should Be Equal As Strings    ${_TempStoryDescription}    ${tcStoryName}
    Should Be Equal    ${_TempStoryEstimate}    ${tcStoryEstimate} Point    # x Point
    Go To Page    Sprint Backlog
    Xpath Should Match X Times    //div[text()="story for taskboard AT"]/../../td[8]/div[text()="new"]    1
    #//td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../..//td[8]/div[text()="new"]
    [Teardown]    TaskBoard - Story ReOpen Teardown

Test TaskBoard - Story Done But All the tasks of Story are not Done in Not Checked Out Stage
    [Documentation]    驗證TaskBoard頁面，有關於 Story 從 Not Checked Out 拖拉至 Checked Out 後，
    ...    但是 tasks 是放置 Stage of Not Checked Out，驗證是否跳出警告視窗。
    [Tags]    Unstable
    [Setup]    TaskBoard - Story Done But All the tasks of Story are not Done Setup
    Set Selenium Speed    ${SELENIUM_SPEED_SLOW}
    Go To Page    TaskBoard
    Wait Until Page Contains Element    xpath=//div[@id="${tcStoryID}_new"]//table[@class="StoryCard_Header"]//td[1]/h2[text()="[Story]\ \ #${tcStoryID}"]/../../../../../../../..
    Wait Until Page Contains Element    xpath=//div[@id="${tcStoryID}_closed"]/div
    Comment    Assign Id To Element    xpath=//div[@id="${tcStoryID}_closed"]/div    doneStageID
    Comment    Drag And Drop    xpath=//div[@id="${tcStoryID}_new"]//table[@class="StoryCard_Header"]//td[1]/h2[text()="[Story]\ \ #${tcStoryID}"]/../../../../../../../..    target=doneStageID
    Drag And Drop    xpath=//div[@id="${tcStoryID}_new"]//table[@class="StoryCard_Header"]//td[1]/h2[text()="[Story]\ \ #${tcStoryID}"]/../../../../../../../..    target=${tcStoryID}_closed
    Sleep    5s
    Wait Until Page Contains    warning!
    Wait Until Page Contains    Please check all the tasks of Story #${tcStoryID} are done.
    ${xpathOKButton}=    Find Current Window Element    warning!    OK
    Element Enable And Submit    ${xpathOKButton}
    # Verify taskcard information
    ${_TempStoryDescription}=    Get Text    xpath=//div[@id="${tcStoryID}_new"]//table[@class="StoryCard_Header"]//td[1]/h2[text()="[Story]\ \ #${tcStoryID}"]/../../../../../../../..//td[@class="StroyCard_Description"]
    ${_TempStoryEstimate}=    Get Text    xpath=//div[@id="${tcStoryID}_new"]//table[@class="StoryCard_Header"]//td[1]/h2[text()="[Story]\ \ #${tcStoryID}"]/../../../../../../../..//td[@class="StoryCard_Value"]
    Should Be Equal As Strings    ${_TempStoryDescription}    ${tcStoryName}
    Should Be Equal    ${_TempStoryEstimate}    ${tcStoryEstimate} Point    # x Point
    Go To Page    Sprint Backlog
    Xpath Should Match X Times    //div[text()="story for taskboard AT"]/../../td[8]/div[text()="new"]    1
    #//td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../..//td[8]/div[text()="new"]
    [Teardown]    TaskBoard - Story Done But All the tasks of Story are not Done Teardown

Test TaskBoard - Story Done But All the tasks of Story are not Done in Checked Out Stage
    [Documentation]    驗證TaskBoard頁面，有關於 Story 從 Not Checked Out 拖拉至 Checked Out 後，
    ...    但是 tasks 是放置 Stage of Checked Out，驗證是否跳出警告視窗。
    [Tags]    Unstable
    [Setup]    TaskBoard - Story Done But All the tasks of Story are not Done Setup
    Set Selenium Speed    ${SELENIUM_SPEED_SLOW}
    Go To Page    TaskBoard
    Task Checked Out With Arguments    ${tcStoryID}    ${tcTaskID}
    Drag And Drop    xpath=//div[@id="${tcStoryID}_new"]//table[@class="StoryCard_Header"]//td[1]/h2[text()="[Story]\ \ #${tcStoryID}"]/../../../../../../../..    target=${tcStoryID}_closed
    Wait Until Page Contains    warning!
    Wait Until Page Contains    Please check all the tasks of Story #${tcStoryID} are done.
    ${xpathOKButton}=    Find Current Window Element    warning!    OK
    Element Enable And Submit    ${xpathOKButton}
    # Verify taskcard information
    ${_TempStoryDescription}=    Get Text    xpath=//div[@id="${tcStoryID}_new"]//table[@class="StoryCard_Header"]//td[1]/h2[text()="[Story]\ \ #${tcStoryID}"]/../../../../../../../..//td[@class="StroyCard_Description"]
    ${_TempStoryEstimate}=    Get Text    xpath=//div[@id="${tcStoryID}_new"]//table[@class="StoryCard_Header"]//td[1]/h2[text()="[Story]\ \ #${tcStoryID}"]/../../../../../../../..//td[@class="StoryCard_Value"]
    Should Be Equal As Strings    ${_TempStoryDescription}    ${tcStoryName}
    Should Be Equal    ${_TempStoryEstimate}    ${tcStoryEstimate} Point    # x Point
    Go To Page    Sprint Backlog
    Xpath Should Match X Times    //div[text()="story for taskboard AT"]/../../td[8]/div[text()="new"]    1
    [Teardown]    TaskBoard - Story Done But All the tasks of Story are not Done Teardown

Test TaskBoard - Attach File on Story
    [Setup]    TaskBoard_AttachFile - Setup
    Page Should Contain    TestProject01
    Click Element    //div[text()="TestProject01"]
    Go To Page    TaskBoard
    #Attach file to Story
    Click Element    //td[@class='StroyCard_Description']/h1[text()='story01']/../../../tr/td/table/tbody/tr/td[2]/a[@title='Upload File']/img
    ${attachFilePath}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    TaskBoard    Story01AttachFile.txt
    Choose File    //input[@name="file"]    ${attachFilePath}
    Click button    //button[text()="Submit"]
    Wait Until Page Contains    Success.
    Wait Until Element Is Visible    //td[@class='StroyCard_Description']/h1[text()='story01']/../../../tr/td/p/a[@target='_blank']
    ${fileName1} =    Get Text    xpath=//table[@class="StoryCard_Table"]/tbody/tr[3]/td/p[2]/a[1]
    Should Be Equal    ${fileName1}    Story01AttachFile.txt
    [Teardown]    TaskBoard_AttachFile - Teardown on Story

Test TaskBoard - Attach File on Task
    [Setup]    TaskBoard_AttachFile - Setup
    Page Should Contain    TestProject01
    Click Element    //div[text()="TestProject01"]
    Go To Page    TaskBoard
    #Attach file to Task
    Wait Until Element Is Visible    //td[@class='TaskCard_Description']/h1[text()='task02']/../../../tr/td/table/tbody/tr/td[3]/a[@title='Upload File']
    Click Element    //td[@class='TaskCard_Description']/h1[text()='task02']/../../../tr/td/table/tbody/tr/td[3]/a[@title='Upload File']
    ${attachFilePath}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    TaskBoard    Task02AttachFile.txt
    Choose File    //input[@name="file"]    ${attachFilePath}
    Click Button    //button[text()="Submit"]
    Wait Until Page Contains    Success.
    Wait Until Element Is Visible    //td[@class='TaskCard_Description']/h1[text()='task02']/../../../tr/td/p/a[@target='_blank']
    ${fileName2} =    Get Text    //td[@class='TaskCard_Description']/h1[text()='task02']/../../../tr/td/p/a[@target='_blank']
    Should Be Equal    Task02AttachFile.txt    ${fileName2}
    [Teardown]    TaskBoard_AttachFile - Teardown on Task

Test TaskBoard - Task Done with partner
    [Setup]    TaskBoard - Task Done with Partner Setup
    Comment    Go To Page    TaskBoard
    Comment    Click Element    xpath=//div[@id="1_assigned"]//table[@class="TaskCard_Header"]//td[3]/a[1]/img
    Comment    Compare Field Content    //input[@name="Name"]    Task02
    Comment    Compare Field Content    //input[@name="HandlerComboBox_ForEditTask"]    Acount01
    Comment    Compare Field Content    //input[@name="Partners"]    Acount02
    Comment    Compare Field Content    //input[@name="Estimate"]    5
    Comment    Compare Field Content    //input[@name="Remains"]    5
    Comment    Click Element    xpath=//button[text()="Cancel"]
    Comment    Drag And Drop    xpath=//div[@id="1_assigned"]//table[@class="TaskCard_Header"]//td[2]/h2[text()="[Task]\ \ #2"]/../../../../../../../..    target=1_closed
    Comment    Click Element    xpath=//button[text()="Done"]
    Comment    Wait Until Page Contains    Success.
    Comment    Click Element    xpath=//div[@id="1_closed"]//table[@class="TaskCard_Header"]//td[3]/a[1]/img
    Comment    Compare Field Content    //input[@name="Name"]    Task02
    Comment    Compare Field Content    //input[@name="HandlerComboBox_ForEditTask"]    Acount01
    Comment    Compare Field Content    //input[@name="Partners"]    Acount02
    Comment    Compare Field Content    //input[@name="Estimate"]    5
    Comment    Compare Field Content    //input[@name="Remains"]    0
    Comment    Click Element    xpath=//button[text()="Cancel"]
    [Teardown]    TaskBoard - Task Done with Partner Teardown

Test TaskBoard - Check Task Checked Out
    [Setup]    TaskBoard - Task Checked Out Setup
    Go To Page    TaskBoard
    Go To Page    Sprint Backlog
    Go To Page    TaskBoard
    Task Checked Out With Arguments    ${tcStoryID}    ${tcTaskID}
    # Verify taskcard information
    ${_TaskHandler}=    Set Variable    admin
    ${_TempTaskDescription}=    Get Text    xpath=//div[@id="${tcStoryID}_assigned"]//table[@class="TaskCard_Header"]//td[2]/h2[text()="[Task]\ \ #${tcTaskID}"]/../../../../../../../..//td[@class="TaskCard_Description"]
    ${_TempTaskEstimate}=    Get Text    xpath=//div[@id="${tcStoryID}_assigned"]//table[@class="TaskCard_Header"]//td[2]/h2[text()="[Task]\ \ #${tcTaskID}"]/../../../../../../../..//td[@class="TaskCard_Value"]
    ${_TempTaskHandler}=    Get Text    xpath=//div[@id="${tcStoryID}_assigned"]//table[@class="TaskCard_Header"]//td[2]/h2[text()="[Task]\ \ #${tcTaskID}"]/../../../../../../../..//span[@class="TaskCard_Handler"]
    Should Be Equal As Strings    ${_TempTaskDescription}    task 1 for test task Checked Out
    Should Be Equal    ${_TempTaskEstimate}    3 hr    # x hr
    Should Be Equal As Strings    ${_TempTaskHandler}    ${_TaskHandler}
    Go To Page    Sprint Backlog
    Go To Page    TaskBoard
    Xpath Should Match X Times    //td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../../../tr[2]//div[text()="${tcTaskName}"]/../../td[3]/div[text()="${tcTaskName}"]    1
    Xpath Should Match X Times    //td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../../../tr[2]//div[text()="${tcTaskName}"]/../../td[6]/div[text()="${tcTaskEstimate}"]    1
    Xpath Should Match X Times    //td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../../../tr[2]//div[text()="${tcTaskName}"]/../../td[7]/div[text()="${_TaskHandler}"]    1
    Xpath Should Match X Times    //td[@class="x-treegrid-col"]/a/span[text()="${tcStoryID}"]/../../../../tr[2]//div[text()="${tcTaskName}"]/../../td[8]/div[text()="assigned"]    1
    [Teardown]    TaskBoard - Task Checked Out Teardown

Test TaskBoard - Check Sprint ID
    [Documentation]    Check if sprint_ID is right, after get to other node and get back to TaskBoard.
    [Setup]    TaskBoard - Check Sprint ID Setup
    Compare Field Content    //span[text()="Sprint Information"]/../../../../../div[2]//label[text()="Sprint Goal:"]/../div/input[@name="SprintGoal"]    Sprint01
    Compare Field Content    //span[text()="Sprint Information"]/../../../../../div[2]//label[text()="Remain Story (Points):"]/../div/input[@name="CurrentStoryPoint"]    20
    Compare Field Content    //span[text()="Sprint Information"]/../../../../../div[2]//label[text()="Remain Task (Hours):"]/../div/input[@name="CurrentTaskPoint"]    22
    Compare Field Content    //label[text()="Sprint ID:"]/../div[1]/div/input    Sprint #1
    ${sprintInitialID}=    Get Value    //label[text()="Sprint ID:"]/../div[1]/div/input
    ${sprintIDSelect}=    Set Variable    //label[text()="Sprint ID:"]/../div[1]/div/input
    Click Element    ${sprintIDSelect}
    ${selectSprint2}=    Set Variable    //div[@class="x-layer x-combo-list "]//div[text()="Sprint #2"]
    Click Element    ${selectSprint2}
    Compare Field Content    //span[text()="Sprint Information"]/../../../../../div[2]//label[text()="Sprint Goal:"]/../div/input[@name="SprintGoal"]    Sprint02
    Compare Field Content    //span[text()="Sprint Information"]/../../../../../div[2]//label[text()="Remain Story (Points):"]/../div/input[@name="CurrentStoryPoint"]    16
    Compare Field Content    //span[text()="Sprint Information"]/../../../../../div[2]//label[text()="Remain Task (Hours):"]/../div/input[@name="CurrentTaskPoint"]    32
    Compare Field Content    //label[text()="Sprint ID:"]/../div[1]/div/input    Sprint #2
    ${sprintBacklog}=    Set Variable    //ul[@class="x-tree-root-ct x-tree-no-lines"]//span[text()="Sprint Backlog"]
    Click Element    ${sprintBacklog}
    ${taskBoard}=    Set Variable    //ul[@class="x-tree-root-ct x-tree-no-lines"]//span[text()="TaskBoard"]
    Click Element    ${taskBoard}
    ${sprntModernID}=    Get Value    //label[text()="Sprint ID:"]/../div[1]/div/input
    Should Be Equal    ${sprintInitialID}    ${sprntModernID}
    Compare Field Content    //span[text()="Sprint Information"]/../../../../../div[2]//label[text()="Sprint Goal:"]/../div/input[@name="SprintGoal"]    Sprint01
    Compare Field Content    //span[text()="Sprint Information"]/../../../../../div[2]//label[text()="Remain Story (Points):"]/../div/input[@name="CurrentStoryPoint"]    20
    Compare Field Content    //span[text()="Sprint Information"]/../../../../../div[2]//label[text()="Remain Task (Hours):"]/../div/input[@name="CurrentTaskPoint"]    22
    Compare Field Content    //label[text()="Sprint ID:"]/../div[1]/div/input    Sprint #1
    [Teardown]    TaskBoard - Check Sprint ID Teardown

Tset TaskBoard - ReleaseID Check
    [Setup]    TaskBoard - Initial Release ID Check Setup
    Go To Page    TaskBoard
    Compare Field Content    //input[@name="ReleaseID"]    None
    [Teardown]    TaskBoard - Initial Release ID Check Teardown

Test TaskBoard - Check Task Consistency After Dragging
    [Setup]    TaskBoard - Check Task Consistency After Dragging Setup
    ${storyID}=    Set Variable    3
    ${taskID}=    Set Variable    9
    Wait Until Page Contains Element    xpath=//div[@id="Task:${taskID}"]//table[@class="TaskCard_Header"]
    ${TaskCardContent}=    Get Text    xpath=//div[@id="Task:${taskID}"]//td[@class="TaskCard_Description"]
    ${TaskCardHandler}=    Get Text    //div[@id="Task:${taskID}"]//span[@class="TaskCard_Handler"]
    Task Done With Arguments    ${storyID}    ${taskID}
    Check TaskCard Contents    ${taskID}    ${TaskCardContent}    ${TaskCardHandler}    0 hr
    [Teardown]    TaskBoard - Check Task Consistency After Dragging Teardown

Test TaskBoard - Check Task ID On The Window After Dragging
    [Documentation]    Try to move TaskBoard between "not Check Out", "Check Out", "Done", and check their ID and Name doesn't change in the windows
    [Setup]    TaskBoard - Check TaskBoard ID And Name Setup
    ${Story_ID}=    Set Variable    1
    ${Task_ID}=    Set Variable    4
    ${Task_NotCheckOut}=    Set Variable    xpath=//div[@id="${Story_ID}_new"]//h2[text()="[Task] \ #${Task_ID}"]
    Wait until Page Contains Element    ${Task_NotCheckOut}
    ${initialTaskName}=    Get Text    ${Task_NotCheckOut}/../../../../../../..//td[@class="TaskCard_Description"]/h1
    Move Task From Not Check Out To Check Out Check ID Before Click Done    ${Story_ID}    ${Task_ID}    ${initialTaskName}
    Move Task From Check Out To Done Check ID Before Click Done    ${Story_ID}    ${Task_ID}    ${initialTaskName}
    Move Task From Done To Check Out Check ID Before Click Done    ${Story_ID}    ${Task_ID}    ${initialTaskName}
    #2017/12/16: We make task card can't move from Checked Out to Not Checked Out when the remains of task card has been changed.
    Comment    Move Task From Check Out To Not Check Out Check ID Before Click Done    ${Story_ID}    ${Task_ID}    ${initialTaskName}
    [Teardown]    TaskBoard - Check TaskBoard ID And Name Teardown

Test TaskBoard - Check Task Consistency After Editing in Done Area
    [Setup]    TaskBoard - Check Task Consistency After Editing in Done Area Setup
    ${storyID}=    Set Variable    3
    ${taskID}=    Set Variable    9
    Wait Until Page Contains Element    //div[@id="Task:${taskID}"]//table[@class="TaskCard_Header"]
    ${TaskCardContent}=    Get Text    //div[@id="Task:${taskID}"]//td[@class="TaskCard_Description"]
    ${TaskCardHandler}=    Get Text    //div[@id="Task:${taskID}"]//span[@class="TaskCard_Handler"]
    Task Done With Arguments    ${storyID}    ${taskID}
    click element    //div[@id="Task:${taskID}"]//img[@src="images/edit.png"]
    ${_XpathEditTaskSubmit}=    Find Current Window Element    Edit Task #${TaskID}    Submit
    Element Enable And Submit    ${_XpathEditTaskSubmit}
    Page Should Contain Element    //div[@id="${storyID}_closed"]//div[@id="Task:${taskID}"]
    Check TaskCard Contents    ${taskID}    ${TaskCardContent}    ${TaskCardHandler}    0 hr
    [Teardown]    TaskBoard - Check Task Consistency After Editing in Done Area Teardown

Test TaskBoard - Check Taskcard Position
    [Documentation]    Check if taskcard position right after moving it from check out \ to done and reloading
    [Setup]    TaskBoard - Check Task Consistency After Editing in Done Area Setup
    Wait until Page Contains Element    xpath=//iframe[@class="chartjs-hidden-iframe"]
    ${Story_ID}=    Set Variable    3
    ${Task_number}=    Set Variable    9
    Move Task From Check Out To Done    ${Story_ID}    ${Task_number}
    Reload Page
    Go To Page    TaskBoard
    Check if Done column has TaskCard    ${Story_ID}    ${Task_number}
    [Teardown]    TaskBoard - Check Task Consistency After Editing in Done Area Teardown

Test TaskBoard - Story and Description_Chrome
    [Documentation]    驗證TaskBoard頁面，有關於 Task 從 Checked Out 拖拉至 Done 後，資料是否正確
    [Tags]    Unstable
    [Setup]    TaskBoard - Task Done Setup
    Set Selenium Speed    ${SELENIUM_SPEED_SLOW}
    Go To Page    TaskBoard
    #Story Card text
    ${stroy_description}=    Get Text    xpath =//td[@class ="StroyCard_Description"]
    Should Be Equal As Strings    ${stroy_description}    Story for taskboard AT story for taskboard text longer than testing engagement expectations environment
    ${subs_story}=    Get Substring    ${stroy_description}    0    47
    Should Be Equal As Strings    ${subs_story}    Story for taskboard AT story for taskboard text
    #Task Card text
    ${task_description}=    Get Text    //td[@class = "TaskCard_Description"]/h1
    Should Be Equal As Strings    ${task_description}    task 1 for test task with longer words such as photosynthesis and environment Another word would be environment
    ${subs_task}=    Get Substring    ${task_description}    0    46
    Should Be Equal As Strings    ${subs_task}    task 1 for test task with longer words such as
    Log    ${subs_task}
    [Teardown]    TaskBoard - Task Done Teardown

Test TaskBoard - Story and Description_IE
    [Documentation]    驗證TaskBoard頁面，有關於 Task 從 Checked Out 拖拉至 Done 後，資料是否正確
    [Tags]    Unstable
    [Setup]    TaskBoard - Setup IE
    Set Selenium Speed    ${SELENIUM_SPEED_SLOW}
    Go To Page    TaskBoard
    #Story Card
    ${stroy_description}    Get Text    xpath =//td[@class ="StroyCard_Description"]
    Should Be Equal As Strings    ${stroy_description}    Story for taskboard AT story for taskboard text longer than testing engagement expectations environment
    ${subs}=    Get Substring    ${stroy_description}    48    97
    Should Be Equal As Strings    ${subs}    longer than testing engagement expectations envir
    #Task Card text
    ${task_description}=    Get Text    //td[@class = "TaskCard_Description"]/h1
    Should Be Equal As Strings    ${task_description}    task 1 for test task with longer words such as photosynthesis and environment Another word would be environment
    ${subs_task}=    Get Substring    ${task_description}    0    46
    Should Be Equal As Strings    ${subs_task}    task 1 for test task with longer words such as
    [Teardown]    TaskBoard - Task Done Teardown

Test TaskBoard - Check Task Remain Hours
    [Setup]    TaskBoard - Check Task Remain Hours Setup
    Click TaskCard Edit Button    ${tcTaskID}
    Check TaskCard Remain Hours Can Not Be Edited
    Move Task    Not Checked Out    Checked Out    ${tcStoryID}    ${tcTaskID}
    Click TaskCard Edit Button    ${tcTaskID}
    TaskCard Remain Hours Should Not Be Zero In Checked Out State
    Move Task    Checked Out    Done    ${tcStoryID}    ${tcTaskID}
    Click TaskCard Edit Button    ${tcTaskID}
    Check TaskCard Remain Hours Can Not Be Edited
    Move Task    Done    Checked Out    ${tcStoryID}    ${tcTaskID}
    Click TaskCard Edit Button    ${tcTaskID}
    Task Remain Hours Should Be Reverted To Last Remain Hours Value When Move From Done To Checked Out    3
    [Teardown]    ezScrum Suite Teardown

Test TaskBoard - Task Remain Hours Changed Cannot Move to Not Checked Out
    [Setup]    TaskBoard - Task Remain Hours Changed cannot Move to Not Checked Out Setup
    Move Task    Not Checked Out    Checked Out    ${tcStoryID}    ${tcTaskID}
    Move Task    Checked Out    Not Checked Out    ${tcStoryID}    ${tcTaskID}
    Move Task    Not Checked Out    Checked Out    ${tcStoryID}    ${tcTaskID}
    Click TaskCard Edit Button    ${tcTaskID}
    Edit Task    Remains    2
    Check If Remains Changed Then TaskCard Can Not Move From Checked Out To Not Checked Out    ${tcStoryID}    ${tcTaskID}
    [Teardown]    ezScrum Suite Teardown

Test TaskBoard - Check Actual Hours has been Removed in Task
    [Setup]    TaskBoard - Check Actual Hours has been Removed in Task Setup
    Check Task Actual Hours Has Been Removed When Edit Task
    Move Task    Not Checked Out    Checked Out    ${tcStoryID}    ${tcTaskID}
    Check Task Actual Hours Has Been Removed When Edit Task
    Check Task Actual Hours Has Been Removed When Move From Checked Out To Done    ${tcStoryID}    ${tcTaskID}
    Check Task Actual Hours Has Been Removed When Edit Task
    [Teardown]    ezScrum Suite Teardown
