*** Settings ***
Library           ../lib/Selenium2Improved.py
Resource          ../../Global Define.txt
Resource          ../Project/ezScrum_Project.txt
Resource          ../../ServerConfig.txt

*** Keywords ***
Test SprintPlan Setup
    Clean DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${DB_NAME}

Test Create Sprint Setup
    #setup
    Open Browser    ${LOGIN_URL}    ${BROWSER}
    ${attachFilePath}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    SprintPlan    Create_Sprint.sql
    Load Database    ${DB_URL}    ${DB_NAME}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${attachFilePath}
    Maximize Browser Window
    _InputLoginForm    ${userName}    ${userPassword}
    #Select project
    Select Project    localtestProjectDisplayName

Test Create Sprint Teardown
    Clean DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${DB_NAME}
    Clean Microservice DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    account_ms
    Exit ezScrum System

Test Delete Sprint Setup
    #setup
    Open Browser    ${LOGIN_URL}    ${BROWSER}
    ${attachFilePath}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    SprintPlan    Delete_Sprint.sql
    Load Database    ${DB_URL}    ${DB_NAME}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${attachFilePath}
    Maximize Browser Window
    _InputLoginForm    ${userName}    ${userPassword}
    #Select project
    Select Project    localtestProjectDisplayName

Test Delete Sprint Teardown
    Clean DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${DB_NAME}
    Clean Microservice DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    account_ms
    Exit ezScrum System

Test Sprint Goal With NewLine Setup
    #setup
    Open Browser    ${LOGIN_URL}    ${BROWSER}
    ${attachFilePath}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    SprintPlan    Sprint_Goal_With_NewLine.sql
    Load Database    ${DB_URL}    ${DB_NAME}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${attachFilePath}
    Maximize Browser Window
    _InputLoginForm    ${userName}    ${userPassword}
    #Select project
    Select Project    localtestProjectDisplayName

Test Sprint Goal With NewLine Teardown
    Clean DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${DB_NAME}
    Clean Microservice DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    account_ms
    Exit ezScrum System

Test Sprint Session Setup
    # 開啟第二個新分頁並登入到第二個專案
    Set Test Variable    ${tcBrowserAlias_A}    ${PROJECT_NAME}_A
    New Tab With Alias    ${LOGIN_URL}    ${tcBrowserAlias_A}
    Wait Until Page Contains Element    createProjectBtn
    # 確認專案是否存在
    ${_IsProjectIDExisted}=    Check ProjectID Is Existed    ${PROJECT_NAME}_A
    Run Keyword If    "${_IsProjectIDExisted}"=="false"    Create Project With Arguments    ${PROJECT_NAME}_A    ${PROJECT_NAME}DisplayName_A    ${PROJECT_COMMENT}_A    ${PROJECT_MANAGER}_A
    Run Keyword If    "${_IsProjectIDExisted}"=="true"    Select Project    ${PROJECT_NAME}DisplayName_A
    # 開啟第二個新分頁並登入到第二個專案
    Set Test Variable    ${tcBrowserAlias_B}    ${PROJECT_NAME}_B
    New Tab With Alias    ${LOGIN_URL}    ${tcBrowserAlias_B}
    Wait Until Page Contains Element    createProjectBtn
    # 確認專案是否存在
    ${_IsProjectIDExisted}=    Check ProjectID Is Existed    ${PROJECT_NAME}_B
    Run Keyword If    "${_IsProjectIDExisted}"=="false"    Create Project With Arguments    ${PROJECT_NAME}_B    ${PROJECT_NAME}DisplayName_B    ${PROJECT_COMMENT}_B    ${PROJECT_MANAGER}_B
    Run Keyword If    "${_IsProjectIDExisted}"=="true"    Select Project    ${PROJECT_NAME}DisplayName_B

Test Sprint Session Teardown
    Select Window    ${PROJECT_NAME}_A
    Clean All Sprint
    Select Window    ${PROJECT_NAME}_B
    Clean All Sprint

Test Check End Date and Demo Date Setup
    #setup
    Open Browser    ${LOGIN_URL}    ${BROWSER}
    ${attachFilePath}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    SprintPlan    Check_End_Date_and_Demo_Date.sql
    Load Database    ${DB_URL}    ${DB_NAME}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${attachFilePath}
    Maximize Browser Window
    _InputLoginForm    ${userName}    ${userPassword}
    #Select project
    Select Project    localtestProjectDisplayName

Test Check End Date and Demo Date Teardown
    Clean DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${DB_NAME}
    Clean Microservice DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    account_ms
    Exit ezScrum System

Test Check Recommended Start Date Setup
    #setup
    Open Browser    ${LOGIN_URL}    ${BROWSER}
    ${attachFilePath}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    SprintPlan    Check_Recommended_Start_Date.sql
    Load Database    ${DB_URL}    ${DB_NAME}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${attachFilePath}
    Maximize Browser Window
    _InputLoginForm    ${userName}    ${userPassword}
    #Select project
    Select Project    localtestProjectDisplayName

Test Check Recommended Start Date Teardown
    Clean DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${DB_NAME}
    Clean Microservice DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    account_ms
    Exit ezScrum System

Test SprintPlan Teardown
    Clean DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${DB_NAME}

Test Interval Check Setup
    Open Browser    ${LOGIN_URL}    ${BROWSER}
    ${attachFilePath}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    SprintPlan    New_Sprint_Submit_Check.sql
    Load Database    ${DB_URL}    ${DB_NAME}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${attachFilePath}
    Maximize Browser Window
    _InputLoginForm    ${userName}    ${userPassword}
    Select Project    testProject

Test Interval Check Teardown
    Clean DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${DB_NAME}
    Clean Microservice DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    account_ms
    Exit ezScrum System

Test Can Not Create Second Sprint With Same Date Setup
    Open Browser    ${LOGIN_URL}    ${BROWSER}
    ${attachFilePath}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    SprintPlan    Can Not Create Second Sprint With Same Date.sql
    Load Database    ${DB_URL}    ${DB_NAME}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${attachFilePath}
    Maximize Browser Window
    _InputLoginForm    ${userName}    ${userPassword}
    Select Project    Test Project

Test Can Not Create Second Sprint With Same Date Teardown
    Clean DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    ${DB_NAME}
    Clean Microservice DB    ${DB_URL}    ${DB_ACCOUNT}    ${DB_PASSWORD}    account_ms
    Exit ezScrum System
