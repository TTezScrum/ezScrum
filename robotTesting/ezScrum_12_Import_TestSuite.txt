*** Settings ***
Suite Setup
Suite Teardown
Force Tags        Import
Resource          keywords/Import/ezScrum_Import.txt
Library           String

*** Test Cases ***
Test Import - Check Project
    [Setup]    Test Import Setup
    Comment    # 驗證 Project
    Comment    Wait Until Page Contains    Project01
    Comment    Page Should Contain    Project01
    Comment    Page Should Contain    Project02
    Comment    # 進入 Project01
    Comment    Click Element    xpath=//div[text()="Project01"]
    Comment    #進入Prodouct Backlog
    Comment    Assert ProductBacklog story
    Comment    #進入Release Plan
    Comment    Assert ReleasePlan
    Comment    #進入Sprint Plan
    Comment    Assert SprintPlan
    Comment    #進入Sprint Backlog
    Comment    Assert SprintBacklog
    Comment    #r進入 Retrospective
    Comment    Assert Retrospective
    Comment    #進入Uplanned
    Comment    Assert Unplanned
    [Teardown]    Test Import Teardown

Test Import - Find duplicated \ accounts and projects
    [Setup]    Test Import Same name Setup
    Comment    # 點選 Import 頁面
    Comment    Click Element    xpath=//u[text()="Import"]
    Comment    # 取得 JSON 完整路徑
    Comment    ${JOSN_PATH}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    import
    ...    golden_answer_new_project01_account01_account02.json
    Comment    #點選 Browse 按鈕
    Comment    Choose File    xpath=//input[@id="files-file"]    ${JOSN_PATH}
    Comment    Click Element    xpath=//button[text()="Import"]
    Comment    # 點選YES
    Comment    Click Element    xpath=//button[text()="Yes"]
    Comment    # Enter Administrator's password
    Comment    Focus AND Input Text    //input[@type='password']    admin
    Comment    # Press OK
    Comment    Click Element    xpath=//button[text()="OK"]
    Comment    # 等待匯出成功
    Comment    Wait Until Page Contains    Project Import successfully.
    Comment    Click Element    xpath=//button[text()="OK"]
    Comment    #回到Projcet List
    Comment    Click Element    xpath=//td[text()="ProjectList"]
    Comment    #測試
    Comment    ${originPattern}    Set Variable    [Project01]{1,9}[_]{1}[0-9]{14}
    Comment    Wait Until Element Is Visible    //div[contains(text(), "Project01_")]
    Comment    ${PROJECTNAME}=    Get Text    //div[contains(text(), "Project01_")]
    Comment    Should Match Regexp    ${PROJECTNAME}    ${originPattern}
    Comment    # 進入 Management 頁面
    Comment    Click Element    xpath=//td[text()="Management"]
    Comment    # account01
    Comment    Page Should Contain    account01
    Comment    ${testAccount01}    Get Text    //div[text()="account01"]/../../td[2]/div
    Comment    Should Be Equal    ${testAccount01}    account01_oldInfo
    Comment    ${testAccount01email}    Get Text    //div[text()="account01"]/../../td[3]/div
    Comment    Should Be Equal    ${testAccount01email}    account01_oldInfo@gmail.com
    Comment    # account02
    Comment    Page Should Contain    account02
    Comment    ${testAccount02}    Get Text    //div[text()="account02"]/../../td[2]/div
    Comment    Should Be Equal    ${testAccount02}    account02_Info
    Comment    ${testAccount02email}    Get Text    //div[text()="account02"]/../../td[3]/div
    Comment    Should Be Equal    ${testAccount02email}    account02_Info@gmail.com
    [Teardown]    Test Import Teardown

Test Import - Check Permission Administrator
    [Setup]    Login Page    ${LOGIN_URL}
    #Management
    Click Element    xpath=//td[text()="Management"]
    Page Should Contain    Import
    Click Element    xpath=//u[text()="Import"]    #Only admin can see this
    [Teardown]    Test Import - Check Permission Teardown

Test Import - Check Permission Normal User
    [Setup]    Test Import - Check Permission Normal User Setup
    #Login with newly created account
    Login Page With Account In The Same Browser    test    test
    Click Element    xpath=//td[text()="Management"]
    Page Should Not Contain    Import
    [Teardown]    Test Import - Check Permission Teardown

Test Import - Check Permission Other Administrator
    [Setup]    Test Import - Check Permission Other Administrator Setup
    #Login with newly created account
    Login Page With Account In The Same Browser    test    test
    #Management
    Click Element    xpath=//td[text()="Management"]
    Page Should Contain    Import
    Click Element    xpath=//u[text()="Import"]    #Only admin can see this
    [Teardown]    Test Import - Check Permission Other Administrator Teardown

Test Import - Check Project by Other Administrator
    [Setup]    Test Import - Check Project by Other Administrator Setup
    Comment    #Login with newly created account
    Comment    Login Page With Account In The Same Browser    test    test
    Comment    # 進入 Management 頁面
    Comment    Click Element    xpath=//td[text()="Management"]
    Comment    # 點選 Import 頁面
    Comment    Click Element    xpath=//u[text()="Import"]
    Comment    # 取得 JSON 完整路徑
    Comment    ${JOSN_PATH}=    Catenate    SEPARATOR=\\    ${EXECDIR}    TestData    import
    ...    golden_answer_project01_project02.json
    Comment    #點選 Browse 按鈕
    Comment    Choose File    xpath=//input[@id="files-file"]    ${JOSN_PATH}
    Comment    Click Element    xpath=//button[text()="Import"]
    Comment    # 點選YES
    Comment    Click Element    xpath=//button[text()="Yes"]
    Comment    # Enter Administrator's password
    Comment    Focus AND Input Text    //input[@type='password']    test
    Comment    # Press OK
    Comment    Click Element    xpath=//button[text()="OK"]
    Comment    # 等待匯出成功
    Comment    Wait Until Page Contains    Project Import successfully.
    Comment    Click Element    xpath=//button[text()="OK"]
    Comment    #回到Projcet List
    Comment    Click Element    xpath=//td[text()="ProjectList"]
    Comment    # 驗證 Project
    Comment    Page Should Contain    Project01
    Comment    Page Should Contain    Project02
    Comment    # 進入 Project01
    Comment    Click Element    xpath=//div[text()="Project01"]
    Comment    #進入Prodouct Backlog
    Comment    Assert ProductBacklog story
    Comment    #進入Release Plan
    Comment    Assert ReleasePlan
    Comment    #進入Sprint Plan
    Comment    Assert SprintPlan
    Comment    #進入Sprint Backlog
    Comment    Assert SprintBacklog
    Comment    #r進入 Retrospective
    Comment    Assert Retrospective
    Comment    #進入Uplanned
    Comment    Assert Unplanned
    [Teardown]    Test Import - Check Project by Other Administrator Teardown
